<div class="flex items-start justify-center p-6">
  <div
    class="w-full max-w-5xl bg-white rounded-2xl shadow-md border border-slate-200 p-6 space-y-6"
  >
    <header class="space-y-1">
      <h2 class="text-3xl font-bold tracking-tight text-slate-900">
        CSV Upload
      </h2>
      <p class="text-sm text-slate-500">
        Lade eine CSV-Datei mit Verträgen hoch.
      </p>
    </header>
    <section class="space-y-4">
      <label
        for="fileInput"
        class="flex flex-col items-center justify-center w-full border-2 border-dashed border-slate-300 rounded-xl px-6 py-8 cursor-pointer hover:border-slate-400 hover:bg-slate-50 transition-colors duration-300"
      >
        <div class="flex flex-col items-center text-center space-y-2">
          <span class="text-sm font-medium text-slate-800">
            Datei auswählen
          </span>
          <span class="text-xs text-slate-500">
            Erlaubt: <span class="font-semibold">.csv</span>
          </span>

          @if (selectedFile) {
          <span
            class="mt-3 inline-flex items-center gap-2 rounded-full bg-emerald-50 px-3 py-1 text-xs font-medium text-emerald-700"
          >
            <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
            {{ selectedFile.name }}
          </span>
          }
        </div>

        <input
          id="fileInput"
          type="file"
          accept=".csv"
          (change)="onFileSelected($event)"
          class="hidden"
        />
      </label>

      <div class="flex items-center justify-end gap-3">
        @if (status === 'uploading') {
        <span class="text-sm text-slate-500"> Datei wird hochgeladen… </span>
        }

        <button
          type="button"
          (click)="onUpload()"
          [disabled]="!selectedFile || status === 'uploading'"
          class="inline-flex items-center justify-center rounded-lg px-4 py-2 text-sm font-semibold text-white bg-sky-600 hover:bg-sky-700 disabled:bg-slate-300 disabled:text-slate-500 disabled:cursor-not-allowed transition-colors"
        >
          @if (status === 'uploading') {
          <span class="inline-flex items-center gap-2">
            <span
              class="h-4 w-4 border-2 border-white/40 border-t-white rounded-full animate-spin"
            ></span>
            Wird hochgeladen…
          </span>
          } @else {
          <span>Hochladen</span>
          }
        </button>
      </div>
    </section>

    @if (status !== 'idle') {
    <section class="space-y-4">
      @if (status === 'success') {
      <div
        class="rounded-lg bg-emerald-50 border border-emerald-200 px-4 py-3 text-sm text-emerald-800 space-y-1"
      >
        <p class="font-semibold">Erfolgreich hochgeladen!</p>
        <div class="flex flex-col">
          @if (importedCount !== null) {
          <span
            >Importierte Zeilen:
            <span class="font-semibold">{{ importedCount }}</span>
          </span>
          } @if (notImportedCount !== null) {
          <span
            >Fehlerhafte Zeilen:
            <span class="font-semibold">{{ notImportedCount }}</span>
          </span>
          } @if (uploadDuration) {
          <span
            >Gebrauchte Zeit:
            <span class="font-semibold"> {{ uploadDuration }} Sekunden </span>
          </span>
          }
        </div>
      </div>
      } @if (status === 'error') {
      <div
        class="rounded-lg bg-rose-50 border border-rose-200 px-4 py-3 text-sm text-rose-800 space-y-2"
      >
        <p class="font-semibold">{{ errorMessage }}</p>
        <div class="flex flex-col">
          @if (importedCount !== null) {
          <span
            >Importierte Zeilen:
            <span class="font-semibold">{{ importedCount }}</span>
          </span>
          } @if (notImportedCount !== null) {
          <span
            >Fehlerhafte Zeilen:
            <span class="font-semibold">{{ notImportedCount }}</span>
          </span>
          } @if (uploadDuration) {
          <span
            >Gebrauchte Zeit:
            <span class="font-semibold"> {{ uploadDuration }} Sekunden </span>
          </span>
          }
        </div>
        @if (backendErrors) {
        <div class="mt-2 space-y-2">
          <ul class="max-h-52 overflow-auto space-y-1 pr-1">
            @for (err of backendErrors; track $index) {
            <li
              class="rounded-md bg-white/60 px-3 py-2 text-xs text-rose-900 border border-rose-100"
            >
              <p>
                @if (err.line) {
                <span class="font-medium">Zeile {{ err.line }}</span>
                <span class="text-slate-400"> · </span>
                }
                <span class="font-medium"
                  >Vertragsnummer {{ err.contract_number }}</span
                >:
                {{ err.error }}
              </p>
            </li>
            }
          </ul>
        </div>
        }
      </div>
      }
    </section>
    }
  </div>
</div>
